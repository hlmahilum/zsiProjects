
@{
    ViewBag.Title = "JavaScript List";
    Layout = "~/Views/Shared/_Admin.cshtml";
}

<div class="pageTitle">JavaScripts </div> 

	<div class="form-horizontal ">
		<div class="form-group  ">
			<div class="col-xs-12">
				<label class=" col-xs-1 control-label">Page Name:</label>
				<div class=" col-xs-2">
					<input type="text" name="filter_name" id="filter_name" class="form-control input-sm ">
				</div>

				<label class=" col-xs-1 control-label">Content:</label>
				<div class=" col-xs-2">
					<input type="text" name="filter_content" id="filter_content" class="form-control input-sm ">
				</div>

				<button type="button" class="btn btn-primary btn-sm" id="btnSearch">
					<span class="glyphicon glyphicon-search"></span>
				</button>
			</div>
		</div>
	</div>
	<div class="zPanel">
		 <div id="grid" class="zGrid"></div>
			
	</div>

	<div class="buttonGroup">
		
		<button id="btnDelete" class="btn btn-primary btn-sm" >
			<span class="glyphicon glyphicon-trash"></span> Delete
		</button>
		<button id="btnGenerateFiles" type="button" class="btn btn-primary btn-sm" >Create Backup</button>
	</div>


<script>
var bs 		= zsi.bs.ctrl;
var svn =  zsi.setValIfNull;
var controller_url = base_url + "javascript/";

$(document).ready(function(){
    setInputs();

    displayDataToGrid();

    $("#btnGenerateFiles").click(function(){

        $.getJSON(controller_url + "selfBackup"
            ,function(data){
                if (data) {
                    alert("Backup files has been created.")
                }
            }
       );

    });


});

function setInputs() {
    filter_name = $("#filter_name");
    filter_content = $("#filter_content");

    $("#filter_name,#filter_content").keyup(function (e) {
        var key = e.which;
        if (key == 13) {
            getData();
        }
    });
}

 

function displayDataToGrid(_url) {
    if (_url == null) _url = base_url + "sql/exec?p=javascripts_sel";
	/*
    $("#grid").loadData({
         url    : url
        ,td_body: [
            function(d){
                return '<input id="cb" name="cb" class="" type="checkbox">'
                + '<input id="js_id" name="js_id" value="' + d.js_id + '" type="hidden">'
            }
            , function (d) { return '<a target="_blank" href="' + base_url + 'javascript/source/' + d.page_name + '">' + d.page_name + '</a>'; }
            ,function(d){ return d.rev_no; }
            ,function(d){ return d.created_by; }
            ,function(d){ return d.created_date; }
            ,function(d){ return d.updated_by; }
            ,function(d){ return d.updated_date; }
        ]

    });
	*/
	 var cb = bs({name:"cbFilter1",type:"checkbox"});
 

 
     $("#grid").dataBind({
	     url            : _url
	    ,width          : $(document).width() - 50
	    ,height         : $(document).height() - 250
	    ,selectorType   : "checkbox"
        //,blankRowsLimit:5
        ,isPaging : false
        ,dataRows : [
                 {text  : cb  , width : 25        , style : "text-align:left;"       
        		    , onRender      :  function(d){ 
                		                    return     bs({name:"js_id",type:"hidden",value: svn(d,"js_id")})
                                                      +  (d !==null ? bs({name:"cb",type:"checkbox"}) : "" );
                      }
				}	
                ,{ text  : "Page Name"  , width : 150        , style : "text-align:left;"       
        		    , onRender      :  function(d){ 
						return  '&nbsp;<a target="_blank" href="' + base_url + 'javascript/source/' + d.page_name + '">' + d.page_name + '</a>';;
                    }
				}	
				 
        		,{text  : "Revision"     , name  : "rev_no"     		, width : 65       	, style : "text-align:center;"}
        		,{text  : "Created By"   , name  : "created_by_name"  	, width : 180      	 , style : "text-align:left;"}
        		,{text  : "Created Date" , name  : "created_date"   	, width : 133          , style : "text-align:left;"}
        		,{text  : "Updated By"   , name  : "updated_by_name" 	, width : 180          , style : "text-align:left;"}
        		,{text  : "Updated Date" , name  : "updated_date"   	, width : 133          , style : "text-align:left;"}
	    ] 
    	     ,onComplete: function(){
                $("#cbFilter1").setCheckEvent("#grid input[name='cb']");
        }  
    });     
	
}

     

$("#btnSearch").click(function(){   
    getData();
});

function getData() {
    displayDataToGrid(
         base_url + "sql/exec?p=javascripts_sel null,'" + filter_name.val() + "','" + filter_content.val() + "'"
    );
}


$("#btnDelete").click(function () {
    zsi.form.deleteData({
         code      : "sys-0001"
        ,onComplete: function (data) {
            displayDataToGrid();
        }
    });

});


</script>


